import{k as R,a1 as T,a2 as M,a0 as L,af as A,l as C,al as l,am as h,an as r}from"./entry.4e55af4f.js";function G(){const t=R(),{changeFilters:I,changePerson:B}=t,{getPersonInfo:v}=T(),n=M(),{toggleGeneration:g,addNewImages:p,toggleLike:O,deletedImage:x,changeTotalImages:S,toggleShowButtonMoreImages:D,changeSizeParameters:_,changeImagePage:$}=n,P=L(),{toggleSnackBarDone:c,toggleSnackBarReject:m}=P,{prepareLogout:u}=A();let o=C(null);function w(){$fetch(`${l}/api/v1/engine/get?engine_id=1`,{method:"GET",redirect:"follow"}).then(e=>{let i={id:e.engine.id,costFactor:e.engine.cost_factor,minWidth:e.engine.min_width,maxWidth:e.engine.max_width,minHeight:e.engine.min_height,maxHeight:e.engine.max_height};_(i)})}function z(e){let i=[r.authorization,r.accept],s={height:t.filters.size.height,width:t.filters.size.width,prompt:t.filters.description,is_upscaled:0,count:t.filters.parameters.countImages,steps:t.filters.parameters.step,engine_id:1,seeds:t.filters.parameters.seed,similarity:t.filters.parameters.navigation};s=t.filters.exception?{...s,negative_prompt:t.filters.exception}:s,$fetch(`${l}/api/v1/image/processing?${new URLSearchParams(s)}`,h("POST",i)).then(a=>{a.status==="success"&&(E(a.image.id,e),I("parameters",{...t.filters.parameters,seed:Math.floor(Math.random()*1e4)}))}).catch(a=>{g(!1),m({isOpen:!0,text:"Что-то пошло не так"});let f=n.images.filter(d=>d.id!==e);p([...f]),a.statusCode===401&&(clearInterval(o.value),u())})}function E(e,i){let s=[r.authorization,r.accept];o.value=setInterval(()=>{$fetch(`${l}/api/v1/image/status?request_id=${e}`,h("POST",s)).then(a=>{if(a.status!=="processing"){console.log(a),clearInterval(o.value);let f=n.images.filter(d=>d.id!==i);p([...a.images,...f]),g(!1),c({isOpen:!0,text:"Изображение сгенерированно"}),v()}}).catch(a=>{g(!1),m({isOpen:!0,text:"Что-то пошло не так"}),a.statusCode===401&&(clearInterval(o.value),u())})},1e3)}function k(e){let i=[r.accept,r.authorization];$fetch(`${l}/api/v1/image/like?image_id=${e}`,h("POST",i)).then(s=>{O(s.image),s.image.is_liked?c({isOpen:!0,text:"Изображение добавленно в избранные"}):c({isOpen:!0,text:"Изображение удалено из избранного"})}).catch(()=>{g(!1),m({isOpen:!0,text:"Что-то пошло не так"}),error.statusCode===401&&(clearInterval(o.value),u())})}function q(e){let i=[r.accept,r.authorization];$fetch(`${l}/api/v1/image/remove?image_id=${e}`,h("DELETE",i)).then(()=>{x(e),c({isOpen:!0,text:"Изображение удалено"}),S(n.totalImages-1),n.totalImages>n.images.length&&n.getImagePages>1&&$(n.getImagePages-1)}).catch(()=>{g(!1),m({isOpen:!0,text:"Что-то пошло не так"}),error.statusCode===401&&(clearInterval(o.value),u())})}return{getModel:w,generateImages:z,likeImage:k,deleteImage:q}}export{G as g};

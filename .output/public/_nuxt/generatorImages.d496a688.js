import{k as q,a0 as R,a1 as M,$ as L,ae as A,ak as c,al as p,am as r}from"./entry.e1b30b43.js";function F(){const t=q(),{changeFilters:x,changePerson:C}=t,{getPersonInfo:S}=R(),i=M(),{toggleGeneration:g,addNewImages:d,toggleLike:_,deletedImage:$,changeTotalImages:T,toggleShowButtonMoreImages:B,changeSizeParameters:v,changeImagePage:I}=i,P=L(),{toggleSnackBarDone:u,toggleSnackBarReject:h}=P,{prepareLogout:f}=A();let o;function w(){$fetch(`${c}/api/v1/engine/get?engine_id=1`,{method:"GET",redirect:"follow"}).then(e=>{let a={id:e.engine.id,costFactor:e.engine.cost_factor,minWidth:e.engine.min_width,maxWidth:e.engine.max_width,minHeight:e.engine.min_height,maxHeight:e.engine.max_height};v(a)})}function k(e){let a=[r.authorization,r.accept],s={height:t.filters.size.height,width:t.filters.size.width,prompt:t.filters.description,is_upscaled:0,count:t.filters.parameters.countImages,steps:t.filters.parameters.step,engine_id:1,seeds:t.filters.parameters.seed,similarity:t.filters.parameters.navigation};s=t.filters.exception?{...s,negative_prompt:t.filters.exception}:s,$fetch(`${c}/api/v1/image/processing?${new URLSearchParams(s)}`,p("POST",a)).then(n=>{n.status==="success"&&(O(n.image.id,e),x("parameters",{...t.filters.parameters,seed:Math.floor(Math.random()*1e4)}))}).catch(n=>{if(n.statusCode===401)clearTimeout(o.value),f();else{g(!1),h({isOpen:!0,text:"Что-то пошло не так"});let m=i.images.filter(l=>l.id!==e);d([...m])}})}function O(e,a){let s=[r.authorization,r.accept];$fetch(`${c}/api/v1/image/status?request_id=${e}`,p("POST",s)).then(n=>{if(n.status!=="processing"){clearTimeout(o);let m=i.images.filter(l=>l.id!==a);d([...n.images,...m]),g(!1),u({isOpen:!0,text:"Изображение сгенерированно"}),S()}else clearTimeout(o),o=setTimeout(()=>O(e,a),1e3)}).catch(n=>{if(n.statusCode===401)clearTimeout(o.value),f();else{g(!1),h({isOpen:!0,text:"Что-то пошло не так"});let m=i.images.filter(l=>l.id!==a);d([...m])}})}function z(e){let a=[r.accept,r.authorization];$fetch(`${c}/api/v1/image/like?image_id=${e}`,p("POST",a)).then(s=>{_(s.image),s.image.is_liked?u({isOpen:!0,text:"Изображение добавленно в избранные"}):u({isOpen:!0,text:"Изображение удалено из избранного"})}).catch(()=>{g(!1),h({isOpen:!0,text:"Что-то пошло не так"}),error.statusCode===401&&(clearTimeout(o.value),f())})}function E(e){let a=[r.accept,r.authorization];$fetch(`${c}/api/v1/image/remove?image_id=${e}`,p("DELETE",a)).then(()=>{$(e),u({isOpen:!0,text:"Изображение удалено"}),T(i.totalImages-1),i.totalImages>i.images.length&&i.getImagePages>1&&I(i.getImagePages-1)}).catch(()=>{g(!1),h({isOpen:!0,text:"Что-то пошло не так"}),error.statusCode===401&&(clearTimeout(o.value),f())})}return{getModel:w,generateImages:k,likeImage:z,deleteImage:E}}export{F as g};
